%   Нечёткая аппроксимация зависимости: y=x1^2*sin(x2-1)
%                                                         (a2_IssledFIS.m)
%  <<< Исследование эффективности систем нечёткого вывода >>>
%==========================================================================
clear all

%--------------------------------------------------------------------------
% Построение графика функции  y=x1^2*sin(x2-1)
% в области    x1 e [-7, 3];  x2 e [-4.4, 1.7]
%---------------------------------------------

n = 15;         % количество точек дискретизации
x1 = linspace(-7,     3, n);
x2 = linspace(-4.4, 1.7, n);

y = zeros(n, n);
for i = 1:n
    y(i,:) = x1.^2 * sin(x2(i)-1);   
end    

%---------------------------------------------
h1 = figure(1);
set(h1,'Position',[5   554   524   407])
% get(h1,'Position')
surf(x1, x2, y)
axis([-10     5 ...
      -6	2 ...
      -50   50]); 
view(-40,30)
xlabel('x_1');   ylabel('x_2');   zlabel('y');
title('Исходная зависимость') 

%--------------------------------------------------------------------------
% Построение графика нечёткого отображения Мамдани
% с треугольными функциями принадл. термов вх.перем.
%---------------------------------------------

fM = readfis('firstM');        % загрузка нечёткой системы с диска
% getfis(fM);
% showfis(fM);

yM = zeros(n, n);
for i = 1:n
    yM(i,:) = evalfis([x1; ones(size(x1))*x2(i)], fM)';    
end  

%---------------------------------------------

h2 = figure(2);
set(h2,'Position',[5    65   524   407])
surf(x1, x2, yM)
axis([-10     5 ...
      -6	2 ...
      -50   50]); 
view(-40,30)
xlabel('x_1');   ylabel('x_2');   zlabel('y');
title('Система нечёткого вывода Мамдани (треуг.функ.прин.) - firstM.fis') 

%--------------------------------------------------------------------------
% Построение графика нечёткого отображения Мамдани
% с гауссовыми функциями принадл. термов вх.перем.
%---------------------------------------------

fMg = readfis('firstMg');       % загрузка нечёткой системы с диска

yMg = zeros(n, n);
for i = 1:n
    yMg(i,:) = evalfis([x1; ones(size(x1))*x2(i)], fMg)';    
end  

%---------------------------------------------

h3 = figure(3);
set(h3,'Position',[536    65   524   407])
surf(x1, x2, yMg)
axis([-10     5 ...
      -6	2 ...
      -50   50]); 
view(-40,30)
xlabel('x_1');   ylabel('x_2');   zlabel('y');
title('Система нечёткого вывода Мамдани (гаус.функ.прин.) - firstMg.fis') 

%--------------------------------------------------------------------------
% Построение графика нечёткого отображения Сугено
%---------------------------------------------

fS = readfis('firstS');       % загрузка нечёткой системы с диска

yS = zeros(n, n);
for i = 1:n
    yS(i,:) = evalfis([x1; ones(size(x1))*x2(i)], fS)';    
end  

%---------------------------------------------

h4 = figure(4);
set(h4,'Position',[1067  65  524  407])
surf(x1, x2, yS)
axis([-10     5 ...
      -6	2 ...
      -50   50]); 
view(-40,30)
xlabel('x_1');   ylabel('x_2');   zlabel('y');
title('Система нечёткого вывода Сугено - firstS.fis') 

%--------------------------------------------------------------------------
% Вычисление среднеквадратических значений ошибки нечёткой аппроксимации
%---------------------------------------------

% FIS Мамдани с треуг.функ.прин.терм.вх.перем.

eMkv = (y-yM).^2;               % квадрат ошибки аппрокс.в узловых точках
SeMkv = sum(sum(eMkv));         % сумма квадратов ошибок по всем точкам
NeM = numel(yM);                % общее количество контрольных точек
RMSE_M = sqrt(SeMkv/NeM);       % среднеквадратичное значение ошибки

% FIS Мамдани с гаус.функ.прин.терм.вх.перем.
RMSE_Mg = sqrt(sum(sum((y-yMg).^2))/numel(yMg));	% среднекв.знач.ошибки

% FIS Сугено
RMSE_S = sqrt(sum(sum((y-yS).^2))/numel(yS));       % среднекв.знач.ошибки

%---------------------------------------------

disp(' ')
disp('Средние квадратические значения ошибки аппроксимации:')
disp([' FIS Мамдани с треуг.функ.прин.терм.вх.перем.:  RMSE = ',  num2str(RMSE_M)])
disp([' FIS Мамдани с гаусс.функ.прин.терм.вх.перем.:  RMSE = ',  num2str(RMSE_Mg)])
disp([' FIS Сугено:                                    RMSE = ',  num2str(RMSE_S)])
disp(' ')

%---------------------------------------------
figure(2);
xlabel(['x_1       RMSE = ',num2str(RMSE_M)]);

figure(3);
xlabel(['x_1       RMSE = ',num2str(RMSE_Mg)]);

figure(4);
xlabel(['x_1       RMSE = ',num2str(RMSE_S)]);
%---------------------------------------------
